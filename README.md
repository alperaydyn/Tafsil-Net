# Tafsil.Net â€“ Quranic Verse Semantic Partitioner

> **ØªÙÙÙ’ØµÙÙŠÙ„** â€“ *Clear exposition through semantic segmentation*

Tafsil.Net is a web and mobile application that provides literal-first translations in Turkish and English (and more later) and partitions Quranic verses into minimal, independently meaningful segments to improve understanding and interpretation. It enables users to explore the Quran with unprecedented granularity and clarity while adding their own corrections and annotations to make the process more personalized and engaging. Powered by Large Language Models (like OpenAI, Gemini, etc), it enables researchers, scholars, and general users to explore the Quran with unprecedented granularity and clarity.

---

## âœ¨ Key Features

- **Semantic Partitioning**: Split verses into minimal, independently meaningful segments
- **Dual Translation**: Turkish and English (literal-first) translations
- **Academic Transliteration**: Using standard conventions (Ã¢, Ã®, Ã», ÅŸ, á¸, á¹£, á¹­, á¸¥, Ê¿, ')
- **Literal-First Priority**: Interpretive additions clearly marked with parentheses
- **LLM-Powered**: Supports various LLM models such as OpenAI, Google Gemini, and Claude
- **User Corrections**: Review and correct LLM outputs through an intuitive interface
- **History & Audit Trail**: Track all changes with user attribution
- **Google Authentication**: Secure sign-in with Google OAuth

---

## ğŸ—ï¸ Technology Stack

| Layer       | Technology                          |
|-------------|-------------------------------------|
| Backend     | Python, FastAPI                     |
| Frontend    | HTML, CSS, JavaScript (Vanilla)     |
| Database    | SQLite                              |
| LLM         | OpenAI API, Google Gemini API       |
| Auth        | Google OAuth 2.0                    |
| Deployment  | Docker, Google Cloud Run            |

---

## ğŸ“ Project Structure

```
tafsil/
â”œâ”€â”€ README.md
â”œâ”€â”€ .env.example          # Environment variables template
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ requirements.txt
â”‚
â”œâ”€â”€ app/                  # FastAPI backend
â”‚   â”œâ”€â”€ main.py           # Application entry point
â”‚   â”œâ”€â”€ api/              # API routes
â”‚   â”œâ”€â”€ core/             # Configuration, security
â”‚   â”œâ”€â”€ db/               # Database models & operations
â”‚   â”œâ”€â”€ llm/              # LLM integration (OpenAI, Gemini)
â”‚   â””â”€â”€ services/         # Business logic
â”‚
â”œâ”€â”€ static/               # Frontend assets
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ css/
â”‚   â””â”€â”€ js/
â”‚
â”œâ”€â”€ data/                 # Quran source data
â”‚   â””â”€â”€ uthmani.txt       # Uthmani text source
â”‚
â”œâ”€â”€ db/                   # SQLite database files
â”‚
â””â”€â”€ prompts/              # LLM prompt templates
    â””â”€â”€ partition_and_translate_v003.txt
```

---

## âš™ï¸ Installation & Setup

### Prerequisites

- Python 3.10+
- Docker (optional, for containerized deployment)
- Google Cloud project with OAuth credentials (for authentication)
- OpenAI API key and/or Google Gemini API key

### 1. Clone the Repository

```bash
git clone https://github.com/alperaydyn/tafsil.git
cd tafsil
```

### 2. Create Virtual Environment

```bash
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
```

### 3. Install Dependencies

```bash
pip install -r requirements.txt
```

### 4. Configure Environment Variables

Create a `.env` file in the project root:

```env
# LLM API Keys
OPENAI_API_KEY=your_openai_api_key
GEMINI_API_KEY=your_gemini_api_key

# Google OAuth
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret

# Application
SECRET_KEY=your_secret_key_for_sessions
DATABASE_URL=sqlite:///./db/tafsil.db
```

### 5. Run the Application

```bash
uvicorn app.main:app --reload
```

Visit `http://localhost:8000` in your browser.

---

## ğŸ³ Docker Deployment

### Build and Run Locally

```bash
docker build -t tafsil .
docker run -p 8000:8000 --env-file .env tafsil
```

### Deploy to Google Cloud Run

```bash
# Build and push to Google Container Registry
gcloud builds submit --tag gcr.io/tafsil-net/tafsil

# Deploy to Cloud Run
gcloud run deploy tafsil \
  --image gcr.io/tafsil-net/tafsil \
  --platform managed \
  --region europe-west3 \
  --allow-unauthenticated
```

---

## ğŸ“– How to Use

1. **Sign in** with your Google account
2. **Enter a verse reference** (e.g., `2:255` for Ayat al-Kursi)
3. **View the semantic partitions** generated by the LLM
4. **Review and correct** any inaccuracies if needed
5. **Save your corrections** â€“ they are stored with your user ID for audit purposes

---

## ğŸ—„ï¸ Database Schema

### Core Tables

| Table         | Description                                    |
|---------------|------------------------------------------------|
| `users`       | User accounts (linked to Google OAuth)         |
| `verses`      | Original Quranic verses (surah:verse)          |
| `partitions`  | Semantic partitions with translations          |
| `corrections` | User corrections with timestamps and user IDs  |
| `audit_log`   | Complete history of all changes                |

---

## ğŸ”Œ API Endpoints

| Method | Endpoint                       | Description                          |
|--------|--------------------------------|--------------------------------------|
| GET    | `/api/verse/{surah}:{verse}`   | Get verse with partitions            |
| POST   | `/api/partition`               | Generate new partitions via LLM      |
| PUT    | `/api/partition/{id}`          | Update/correct a partition           |
| GET    | `/api/history/{surah}:{verse}` | Get correction history for a verse   |
| GET    | `/api/user/me`                 | Get current user info                |

---

## ğŸ¤ Contributing

We welcome contributions from the community! Here's how you can help:

### Getting Started

1. **Fork** the repository
2. **Clone** your fork: `git clone https://github.com/alperaydyn/tafsil.git`
3. **Create a branch**: `git checkout -b feature/your-feature-name`
4. **Make your changes** and commit with clear messages
5. **Push** to your fork: `git push origin feature/your-feature-name`
6. **Open a Pull Request** against the `main` branch

### Guidelines

- **Code Style**: Follow PEP 8 for Python code
- **Commits**: Use clear, descriptive commit messages
- **Documentation**: Update README or docstrings if adding new features
- **Testing**: Add tests for new functionality where applicable
- **Issues**: Check existing issues before creating new ones

### Areas for Contribution

- ğŸŒ Adding new translation languages
- ğŸ¨ UI/UX improvements
- ğŸ§ª Test coverage
- ğŸ“š Documentation
- ğŸ› Bug fixes
- âš¡ Performance optimizations

---

## ğŸ“œ License

This project is released into the public domain under the **Unlicense**. You are free to use, modify, distribute, and build upon this work for any purpose, without any restrictions.

See [UNLICENSE](UNLICENSE) for details.

---

## ğŸ™ Acknowledgments

- Quran text source: [Tanzil.net](https://tanzil.net/) (Uthmani script)
- Inspired by classical Tafsir methodology and modern NLP techniques

---

## ğŸ“¬ Contact

For questions, suggestions, or collaboration opportunities, please open an issue or reach out through the project's GitHub page.

---

<p align="center">
  <em>"ÙˆÙØ£ÙÙ†Ø²ÙÙ„Ù’Ù†ÙØ§ Ø¥ÙÙ„ÙÙŠÙ’ÙƒÙ Ø§Ù„Ø°ÙÙ‘ÙƒÙ’Ø±Ù Ù„ÙØªÙØ¨ÙÙŠÙÙ‘Ù†Ù Ù„ÙÙ„Ù†ÙÙ‘Ø§Ø³Ù Ù…ÙØ§ Ù†ÙØ²ÙÙ‘Ù„Ù Ø¥ÙÙ„ÙÙŠÙ’Ù‡ÙÙ…Ù’"</em><br>
  <sub>And We revealed to you the Reminder to explain to people what has been revealed to them. (16:44)</sub>
</p>